(function(){"use strict";class t{constructor(e){this.container=e,this.track=e.querySelector(".testimonials__track"),this.cards=Array.from(this.track.querySelectorAll(".testimonial-card")),this.prevBtn=e.querySelector(".carousel__btn--prev"),this.nextBtn=e.querySelector(".carousel__btn--next"),this.dotsContainer=e.parentElement.querySelector(".carousel__dots"),this.currentIndex=0,this.isDragging=!1,this.startPos=0,this.currentTranslate=0,this.prevTranslate=0,this.animationID=null,this.init()}init(){if(!this.track||this.cards.length===0)return;this.createDots(),this.attachEventListeners(),this.updateButtons(),this.updateDots()}createDots(){if(!this.dotsContainer)return;this.cards.forEach((e,t)=>{const n=document.createElement("button");n.classList.add("carousel__dot"),n.setAttribute("aria-label",`Перейти к отзыву ${t+1}`),n.addEventListener("click",()=>this.goToSlide(t)),this.dotsContainer.appendChild(n)}),this.dots=Array.from(this.dotsContainer.querySelectorAll(".carousel__dot"))}attachEventListeners(){this.prevBtn&&this.prevBtn.addEventListener("click",()=>this.prev()),this.nextBtn&&this.nextBtn.addEventListener("click",()=>this.next()),this.track.addEventListener("touchstart",this.touchStart.bind(this),{passive:!0}),this.track.addEventListener("touchmove",this.touchMove.bind(this),{passive:!0}),this.track.addEventListener("touchend",this.touchEnd.bind(this)),this.track.addEventListener("mousedown",this.touchStart.bind(this)),this.track.addEventListener("mousemove",this.touchMove.bind(this)),this.track.addEventListener("mouseup",this.touchEnd.bind(this)),this.track.addEventListener("mouseleave",this.touchEnd.bind(this)),this.container.addEventListener("keydown",e=>{e.key==="ArrowLeft"&&this.prev(),e.key==="ArrowRight"&&this.next()}),this.observeCards()}observeCards(){const e={root:this.track,threshold:.3},t=new IntersectionObserver(e=>{e.forEach(e=>{if(e.isIntersecting&&e.intersectionRatio>=.3){const t=this.cards.indexOf(e.target);t!==-1&&(this.currentIndex=t,this.updateButtons(),this.updateDots())}})},e);this.cards.forEach(e=>t.observe(e))}touchStart(e){this.isDragging=!0,this.startPos=this.getPositionX(e),this.animationID=requestAnimationFrame(this.animation.bind(this)),this.track.style.cursor="grabbing"}touchMove(e){if(this.isDragging){const t=this.getPositionX(e);this.currentTranslate=this.prevTranslate+t-this.startPos}}touchEnd(){this.isDragging=!1,cancelAnimationFrame(this.animationID),this.track.style.cursor="grab";const e=this.currentTranslate-this.prevTranslate;e<-50&&this.currentIndex<this.cards.length-1?this.next():e>50&&this.currentIndex>0?this.prev():this.goToSlide(this.currentIndex)}getPositionX(e){return e.type.includes("mouse")?e.pageX:e.touches[0].clientX}animation(){this.isDragging&&requestAnimationFrame(this.animation.bind(this))}goToSlide(e){this.currentIndex=Math.max(0,Math.min(e,this.cards.length-1));const t=this.cards[this.currentIndex];t&&t.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"}),this.updateButtons(),this.updateDots()}prev(){this.currentIndex>0&&this.goToSlide(this.currentIndex-1)}next(){this.currentIndex<this.cards.length-1&&this.goToSlide(this.currentIndex+1)}updateButtons(){this.prevBtn&&(this.prevBtn.disabled=this.currentIndex===0),this.nextBtn&&(this.nextBtn.disabled=this.currentIndex===this.cards.length-1)}updateDots(){if(!this.dots)return;this.dots.forEach((e,t)=>{t===this.currentIndex?(e.classList.add("active"),e.setAttribute("aria-current","true")):(e.classList.remove("active"),e.removeAttribute("aria-current"))})}}function e(){const e=document.querySelectorAll(".testimonials-carousel");e.forEach(e=>new t(e))}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",e):e()})()