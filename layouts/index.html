<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Redirecting...</title>

  <!-- SEO: Router page should not be indexed -->
  <meta name="robots" content="noindex,nofollow">
  <link rel="canonical" href="{{ .Site.BaseURL }}v/a/">

  <!-- Minimal styling for brief flash -->
  <style>
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      background: #f8f9fa;
      color: #666;
    }
  </style>

  {{ if .Site.Params.yandexMetrikaID }}
  <!-- Yandex.Metrika counter (for tracking router visits) -->
  <script type="text/javascript">
    (function (m, e, t, r, i, k, a) {
      m[i] = m[i] || function () { (m[i].a = m[i].a || []).push(arguments) };
      m[i].l = 1 * new Date();
      for (var j = 0; j < document.scripts.length; j++) { if (document.scripts[j].src === r) { return; } }
      k = e.createElement(t), a = e.getElementsByTagName(t)[0], k.async = 1, k.src = r, a.parentNode.insertBefore(k, a)
    })(window, document, 'script', 'https://mc.yandex.ru/metrika/tag.js', 'ym');

    ym({{ .Site.Params.yandexMetrikaID }}, 'init', {
      webvisor: true,
      clickmap: true,
      accurateTrackBounce: true,
      trackLinks: true
    });
  </script>
  {{ end }}

  {{ if .Site.Params.googleAnalyticsID }}
  <!-- Google Analytics 4 (for tracking router visits) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id={{ .Site.Params.googleAnalyticsID }}"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', '{{ .Site.Params.googleAnalyticsID }}');
  </script>
  {{ end }}

  <!-- Router configuration from Hugo -->
  <script>
    window.VARIANT_CONFIG = {
      variants: {{ .Site.Params.variants.list | default (slice "a") | jsonify | safeJS }},
      weights: {{ .Site.Params.variants.weights | default (slice 100) | jsonify | safeJS }},
      defaultVariant: {{ .Site.Params.variants.default | default "a" | jsonify | safeJS }},
      forceParam: {{ .Site.Params.variants.forceParam | default "v" | jsonify | safeJS }},
      enabled: {{ if .Site.Params.variants.enabled }}true{{ else }}false{{ end }},
      yandexMetrikaID: {{ .Site.Params.yandexMetrikaID | default 0 }},
      googleAnalyticsID: {{ .Site.Params.googleAnalyticsID | default "" | jsonify | safeJS }}
    };
  </script>

  <!-- Router script -->
  {{ $router := resources.Get "js/router.js" }}
  {{ if $router }}
  {{ $router = $router | minify | fingerprint }}
  <script src="{{ $router.Permalink }}" integrity="{{ $router.Data.Integrity }}"></script>
  {{ end }}
</head>
<body>
  <!-- Fallback for no-JS users -->
  <noscript>
    <meta http-equiv="refresh" content="0;url=/v/a/">
    <p>Redirecting to <a href="/v/a/">main page</a>...</p>
  </noscript>

  <!-- Brief loading state (JS will redirect immediately) -->
  <div id="loading">Загрузка...</div>
</body>
</html>
